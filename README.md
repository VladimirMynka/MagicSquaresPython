# Магические квадраты
### Оглавление

- [Магические квадраты](#магические-квадраты)
    - [Оглавление](#оглавление)
    - [Введение](#введение)
    - [Алгебраические свойства](#алгебраические-свойства)
      - [Основные свойства](#основные-свойства)
      - [Линейное пространство](#линейное-пространство)
      - [Чарующие квадраты](#чарующие-квадраты)
        - [Таблица 1. Таблица умножения в линейном пространстве m0-m4](#таблица-1-таблица-умножения-в-линейном-пространстве-m0-m4)
        - [Таблица 2. Таблица умножения в линейном пространстве s₀-s₄](#таблица-2-таблица-умножения-в-линейном-пространстве-s-s)
      - [Полумагические квадраты](#полумагические-квадраты)
      - [Норма квадратов и обратный элемент](#норма-квадратов-и-обратный-элемент)
      - [Спектр полумагического квадрата](#спектр-полумагического-квадрата)
      - [Идеалы для полумагических квадратов](#идеалы-для-полумагических-квадратов)
    - [Подходы к решению проблемы квадратных квадратов](#подходы-к-решению-проблемы-квадратных-квадратов)
      - [Минимальный целочисленный магический квадрат](#минимальный-целочисленный-магический-квадрат)
      - [Модульная арифметика](#модульная-арифметика)
      - [Разноцветные квадраты](#разноцветные-квадраты)

### Введение
<details>
<summary>Введение</summary>

**Магический квадрат** - это квадратная матрица чисел, в которой сумма чисел в каждой строке, столбце и диагонали одинакова. Эта сумма называется **магической константой**.
Например, квадрат 3x3:

```
8 1 6
3 5 7
4 9 2
```

Аналогично определяется **полумагический квадрат**, однако не требуется, чтобы сумма чисел в диагоналях была равна магической константе.

До сих пор остаётся нерешённым вопрос, существует ли магический квадрат 3x3, состоящий только из квадратных чисел. В данной работе такой квадрат будет называться **квадратным квадратом**.

Более того, неизвестно, существует ли хотя бы один магический квадрат 3x3, содержащий хотя бы семь квадратных чисел, не считая одного известного:

```
5652²    83521    3732²
232²     4252²   360721
222121²  5272²    2052²
```

Мы предлагаем некоторые подходы, которые не дают полного доказательства, но могут помочь найти решение. С одной стороны, мы приводим
свои наблюдения относительно алгебраических свойств магических квадратов 3x3, которые не имеют решения непосредственно к данной проблеме.
С другой стороны, строим теорию относительно **N/9-квадратных квадратов 3x3**, которые содержат не менее N квадратных чисел.

Так, сводя решение линейной системы уравнений к одному квадратному уравнению в целых числах и решая его, мы полностью покрываем все 4/9 квадраты 3x3 и приводим классификацию решений для них. Для квадратов 5/9 мы демонстрируем, что они требуют решения системы из 2 квадратных уравнений в целых числах, и определяем каждый из видов 5/9 квадратных квадратов как склейку 4/9 квадратных квадратов. Таким образом, мы получаем полную параметризацию для 12 из 22 видов 5/9 квадратных квадратов.

Следуя далее этой логике, мы выделяем несколько видов 6/9-квадратных квадратов, которые требуют решения системы из трёх наиболее простых квадратных уравнений в целых числах вида `a² + b² = 2c²`. Углубляясь в решение этой системы, мы обнаруживаем, что магические квадраты 
такого вида имеют непосредственную связь с конгруэнтными числами. В частности, определяя конгруэнтное число как 
```
f(m, n) = m * n * (m² - n²),
```
где `m` и `n` - взаимно простые числа разной чётности, 

и освобождённое от квадратов конгруэнтное число 

```
tf(m, n) = t(m) * t(n) * t(m - n) * t(m + n),
```
где t(p) = p, t(n²) = 1, t(a * b) = t(a) * t(b), где p - простое число, a, b - взаимно простые числа, n - любое целое число,

задача нахождения магических квадратов 6/9 вида сводится к решению уравнения
```
tf(m1, n1) = tf(m2, n2)
```
где `m1 и n1`, `m2 и n2` - пары взаимно простых чисел разной чётности.

Для данного уравнения нами были выведены 4 частных параметризации, которые покрывают в том числе и единственный известный магический квадрат 7/9, а также выявлены некоторые свойства, которые могут помочь в дальнейшем исследовании. Полученные нами решения полностью покрывают все решения других авторов.
</details>


<details>
<summary>Алгебраические свойства</summary>

### Алгебраические свойства

Данная глава посвящена алгебраическим свойствам магических квадратов 3x3 и не имеет непосредственного отношения к проблеме магических квадратов 3x3, состоящих только из квадратных чисел.

<details>
<summary>Основные свойства</summary>

#### Основные свойства

Очевидно, что магический квадрат 3x3 можно представить в виде линейной системы уравнений с 9 неизвестными и 8 уравнениями.
Решение данной системы сводится к трём базисным решениям, в результате чего множество всех магических квадратов 3x3 может быть сопоставлено с множеством векторов длины 3.

Положим, что магический квадрат 3x3 имеет вид:

```
A B C
D E F
G H I
```

Обозначим магическую константу квадрата через M и сложим верхнюю и нижнюю строки:
```
(A + B + C) + (G + H + I) = M + M = 2M
```

С другой стороны, если мы перегруппируем слагаемые в левой части, то получим:
```
(A + I) + (B + H) + (C + G) = (M - E) + (M - E) + (M - E) = 3M - 3E
```

Откуда 
```
3M - 3E = 2M
M = 3E
``` 

Теперь определим `x = A - E` и `y = G - E`.
Тогда магический квадрат можно представить в виде:
```
E+x     E-x+y  E-y
E-x-y   E      E+x+y
E+y     E+x-y  E-x
```

Пусть m(E, x, y) - магический квадрат 3x3, соответствующий тройке (E, x, y).

</details>

<details>
<summary>Линейное пространство</summary>

#### Линейное пространство
Обратим внимание, что множество всех магических квадратов 3x3 представляет собой линейное пространство над полем комплексных чисел (при обсуждении алгебраических свойств будем считать, что магические квадраты определены для любых комплексных чисел).

Действительно, поскольку все элементы квадрата определены линейно относительно E, x, y, то для любых комплексных чисел E, x, y и c:
```
m1(E1, x1, y1) + m2(E2, x2, y2) = m(E1 + E2, x1 + x2, y1 + y2) 
```
и
```
c * m(E, x, y) = m(c * E, c * x, c * y)
```

Тогда определим базисы данного пространства:
```
m₀ = m(1, 0, 0) = 

1 1 1
1 1 1
1 1 1
```

```
m₁ = m(0, 1, 0) = 

1 -1 0
-1 0 1
0 1 -1
```

```
m₂ = m(0, 0, 1) = 

0 1 -1
-1 0 1
1 -1 0
```

Дополнительно, для магических квадратов достаточно просто записываются их повороты, отражения и транспонирование:
```
Исходный квадрат: m(E, x, y)
Поворот на 90°: m(E, -y, x)
Поворот на 180°: m(E, -x, -y)
Поворот на 270°: m(E, y, -x)

Отражение относительно горизонтальной оси: m(E, y, x)
Отражение относительно вертикальной оси: m(E, -y, -x)
Отражение относительно диагонали (транспонирование): m(E, -x, -y)
```

Все магические квадраты, полученные из исходного квадрата путём данных преобразований, будем называть эквивалентными с точностью до поворота или симметрии (или просто эквивалентными).

</details>

<details>
<summary>Чарующие квадраты</summary>

#### Чарующие квадраты
Применяя матричное умножение, заметим, что 
```
m₀ * m₀ = 3 * m₀

m₀ * m₁ = 0
m₀ * m₂ = 0 
m₁ * m₀ = 0 
m₂ * m₀ = 0
(0 - нулевая матрица)

m₁ * m₁ = m₃
m₁ * m₂ = -m₄
m₂ * m₁ = m₄
m₂ * m₂ = -m₃
```

где 
```
m₃ = 
[[2 -1 -1]
[-1  2 -1]
[-1 -1  2]]
```
```
m₄ = 
[[-1 -1  2]
[ -1  2 -1]
[  2 -1 -1]]
```

А далее можно заметить, что матричное умножение над векторным пространством, порождённым базисами m₀, m₁, m₂, m₃, 3m₄ замкнуто и задано следующей таблицей умножения:

##### Таблица 1. Таблица умножения в линейном пространстве m0-m4
|         | m₀   | m₁   | m₂   | m₃   | m₄   |
|---------|------|------|------|------|------|
| **m₀**  | 3m₀  | 0    | 0    | 0    | 0    |
| **m₁**  | 0    | m₃   | -m₄  | 3m₁  | -3m₂ |
| **m₂**  | 0    | m₄   | -m₃  | 3m₂  | -3m₁ |
| **m₃**  | 0    | 3m₁  | 3m₂  | 3m₃  | 3m₄  |
| **m₄**  | 0    | 3m₂  | 3m₁  | 3m₄  | 3m₃  |

<details>
<summary><b>Дополнительное преобразование базисов</b></summary>

Заметим, что для более удобного представления, можно изменить систему базисов:
```
s₀ = m₀ / 3
s₁ = m₃ / 3
s₂ = m₄ / 3
s₃ = m₁ * √(3) / 3
s₄ = m₂ * √(3) / 3
```

Тогда таблица умножения примет вид:

##### Таблица 2. Таблица умножения в линейном пространстве s₀-s₄
|         | s₀  | s₁  | s₂  | s₃  | s₄  |
|---------|-----|-----|-----|-----|-----|
| **s₀**  | s₀  | 0   | 0   | 0   | 0   |
| **s₁**  | 0   | s₃  | -s₄ | s₁  | -s₂ |
| **s₂**  | 0   | s₄  | -s₃ | s₂  | -s₁ |
| **s₃**  | 0   | s₁  | s₂  | s₃  | s₄  |
| **s₄**  | 0   | -s₂ | s₁  | s₄  | -s₃ |

Однако, поскольку магические квадраты обычно предполагаются содержащими только целые числа, то [Таблица 1](#таблица-1-таблица-умножения-в-линейном-пространстве-m0-m4) является более удобной для вычислений.
</details>


Мы определяем "чарующие квадраты" как множество комбинаций базисов m₀, m₃, m₄.
В таком случае, матричное умножение отображает:
- Пару магических квадратов в чарующий квадрат
- Пару чарующих квадратов в чарующий квадрат
- Пару (чарующий квадрат, магический квадрат) в магический квадрат
- Пару (магический квадрат, чарующий квадрат) в магический квадрат

Данный набор правил умножения замыкает множество магических квадратов относительно тернарного матричного умножения, подобно тому, как это определено для мнимых чисел.

<details>
<summary>Дополнительные выкладки</summary>

Правила умножения квадратов:
```
m(E₁, x₁, y₁) * m(E₂, x₂, y₂) = c(3E₁E₂, x₁x₂ - y₁y₂, y₁x₂ - x₁y₂)
c(E₁, x₁, y₁) * c(E₂, x₂, y₂) = 3c(E₁E₂, x₁x₂ + y₁y₂, y₁x₂ + x₁y₂)
m(E₁, x₁, y₁) * c(E₂, x₂, y₂) = 3m(E₁E₂, x₁x₂ - y₁y₂, y₁x₂ - x₁y₂)
c(E₁, x₁, y₁) * m(E₂, x₂, y₂) = 3m(E₁E₂, x₁x₂ + y₁y₂, y₁x₂ + x₁y₂)
```
</details>

</details>

<details>
<summary>Полумагические квадраты</summary>

#### Полумагические квадраты

По аналогии с магическими квадратами, решение системы линейных уравнений для полумагических квадратов (в которой, напомним, на два уравнения меньше) сводится к пяти базисным решениям, то есть, множество всех полумагических квадратов 3x3 может быть сопоставлено с множеством векторов длины 5.

Одновременно с этим, чарующие квадраты являются полумагическими квадратами. Множество всех сумм магических и чарующих квадратов образует линейное пространство, образованное также пятью базисами, о чём указывалось выше.

Таким образом, пространство сумм магических и чарующих квадратов образуют содержит необходимое и достаточное количество базисных векторов для порождения всех полумагических квадратов, то есть можно говорить о том, что любой полумагический квадрат может быть представлен как сумма магического и чарующего квадратов.

Поскольку базис m₀ относится как к магическим, так и к чарующим квадратам, то расписать полумагический квадрат в виде суммы магического и чарующего квадратов можно бесконечным количеством способов. Поэтому, для удобства, базис m₀ отнесём к чарующим квадратам.

Полумагический квадрат будем определять следующей записью:
```
sm(E, x, y, v, w) = c(E, v, w) + m(0, x, y)
```

<details>
<summary>Дополнительные выкладки</summary>

В общем виде произведение двух полумагических квадратов выглядит следующим образом:
```
sm(E₁, x₁, y₁, w₁, v₁) * sm(E₂, x₂, y₂, w₂, v₂) = 
sm(
   3E₁E₂,
   3x₁w₂ + 3x₂w₁ - 3y₁v₂ + 3y₂v₁,
  -3x₁v₂ + 3x₂v₁ + 3y₁w₂ + 3y₂w₁,
    x₁x₂ -  y₁y₂ + 3w₁w₂ + 3v₁v₂,
   -x₁y₂ +  x₂y₁ + 3w₁v₂ + 3w₂v₁,
)
```
</details>

</details>

<details>
<summary>Норма квадратов и обратный элемент</summary>

#### Норма квадратов и обратный элемент
В качестве нормы полумагичического квадрата можно рассматривать его определитель.
```
det(sm(E, x, y, w, v)) = -9E * (3v² - 3w² + x² - y²)
```

Обратный элемент к полумагическому квадрату существует при ненулевом определителе и может быть записан как
```
sm(E, x, y, v, w)⁻¹ = sm(
  (3v² - 3w² + x² - y²) / 9E,
  -x / 3,
  -y / 3,
   v / 3,
  -w / 3,
) / (3v² - 3w² + x² - y²)
```

Таким образом, все сингулярные полумагические квадраты удовлетворяют уравнению
```
-9E * (3v² - 3w² + x² - y²) <=>

|      E = 0
| ИЛИ  3(v² - 3w²) = x² - y²
```

Второе условие, в случае магических и чарующих квадратов, означает, что абсолютные значения при коэффициентах второго и третьего компонент (m₁ и m₂, m₃ и m₄ соответственно), равны тогда и только тогда, когда квадрат не имеет обратного.

При этом матричная единица сама относится к чарующим квадратам и записывается в них как `c(1/3, 1/3, 0)`.

</details>

<details>
<summary>Спектр полумагического квадрата</summary>

#### Спектр полумагического квадрата
Спектр любого полумагического квадрата задаётся как множество из 1-3 элементов:
```
{
  3v + √(9w² + 3x² - 3y²), 
  3v - √(9w² + 3x² - 3y²), 
  3E
}
```

Соответственно, для чарующего квадрата `c(E, v, w)` спектр:
```
{ 3E, 3v ± 3w }
```

И для магического квадрата `m(E, x, y)` спектр:
```
{ 3E, ±√(3x² - 3y²) }
```

Однако важно учитывать, что элементы `λe - m(E, x, y)` не являются ни магическими, ни чарующими квадратами, так как представляют собой сумму разнородных компонент (e - чарующий квадрат, m(E, x, y) - магический квадрат), в то время как для чарующих все элементы, порождаемые спектром, являются чарующими квадратами.

</details>

<details>
<summary>Идеалы для полумагических квадратов</summary>

#### Идеалы для полумагических квадратов

Несложно заметить, что идеалами для полумагических квадратов являются как минимум два множества квадратов:

1. Множество всех полумагических квадратов, кратных m₀;
2. Множество всех полумагических квадратов, для которых коэффициент при m₀ равен нулю.

<details>
<summary>Доказательство</summary>

1. Докажем, что множество всех полумагических квадратов, кратных m₀, образует идеал.
```
sm(E₀, 0, 0, 0, 0) * sm(E, x, y, v, w) = sm(
   3E₀E,
   3*0*w + 3*x*0 - 3*0*v + 3*y*0,
  -3*0*v + 3*x*0 + 3*0*w + 3*y*0,
     0*x -   0*y + 3*0*w + 3*0*v,
    -0*y +   x*0 + 3*0*v + 3*w*0,
) = sm(3E₀E, 0, 0, 0, 0)
```

2. Докажем, что множество всех полумагических квадратов, для которых коэффициент при m₀ равен нулю, образует идеал.
```
sm(0, x₁, y₁, v₁, w₁) * sm(E, x, y, v, w) = sm(
  3 * 0 * E, 
  ...,
  ...,
  ...,
  ...,
) = sm(0, ..., ..., ..., ...)
```
</details>

Совокупность данных идеалов также образует идеал.

Максимальным идеалом, причём единственным, является множество всех сингулярных полумагических квадратов.

<details>
<summary>Доказательство</summary>

```
Если sm(E₀, x₀, y₀, v₀, w₀) - сингулярный полумагический квадрат, то 
det(sm(E₀, x₀, y₀, v₀, w₀)) = 0

Тогда для любого полумагического квадрата sm(E, x, y, v, w)
det(sm(E₀, x₀, y₀, v₀, w₀) * sm(E, x, y, v, w)) = det(sm(E₀, x₀, y₀, v₀, w₀)) * det(sm(E, x, y, v, w)) = 0 * det(sm(E, x, y, v, w)) = 0 =>

sm(E₀, x₀, y₀, v₀, w₀) * sm(E, x, y, v, w) тоже сингулярный полумагический квадрат
```

По свойствам идеалов, если все сингулярные элементы образуют идеал, то он является максимальным и единственным максимальным, что и требовалось доказать.
</details>

</details>

</details>

### Подходы к решению проблемы квадратных квадратов
<details>
<summary>Подходы к решению проблемы квадратных квадратов</summary>

В данном разделе будут рассмотрены некоторые подходы к решению проблемы квадратных квадратов, те свойства, которыми должны обладать квадратные квадраты.

#### Минимальный целочисленный магический квадрат
Минимальным магическим квадратом назовём такой магический квадрат `m(E, x, y)` из целых `E, x, y ≥ 0`, у которого `НОД(E, x, y) = 1` и `x ≥ y`.

Тогда любой магический квадрат из рациональных чисел может быть получен из минимального магического квадрата путём поворота, отражения и умножения на некоторое рациональное число.

Таким образом, большинство свойств минимального магического квадрата будут справедливы для всех магических квадратов, в силу чего в данном и последующих разделах мы будем рассматривать именно минимальные магические квадраты.

Операцию приведения магического квадрата к минимальному виду будем называть минимизацией.

Особенно это важно в случае поиска квадратного квадрата, так как минимизация квадратного квадрата также является квадратным квадратом.

#### Модульная арифметика
<details>
<summary>Модульная арифметика</summary>
По аналогии с целыми числами, можно рассматривать модульную арифметику для целочисленных магических квадратов (где магические квадраты сравнимы по модулю тогда, когда сравнимы по модулю соответствующие элементы).

В силу того, что каждый элемент магического квадрата `m(E, x, y)` является линейной комбинацией параметров `E`, `x`, `y`, можно записать:
```
m(E, x, y) ≡ m(E % n, x % n, y % n) mod n
```

Лемма 1. Если `m(e², x, y)` - минимальный квадратный квадрат, то `e` нечётное, а `x` и `y` кратны четырём.

<details>
<summary>Доказательство (от противного)</summary>

Рассмотрим квадратный квадрат по модулю 4. 

1. Предположим, что в квадрате `m(e², x, y)` число `e` чётное. Это означает, что магическая константа и центральный элемент делятся на 4,
```
m(e², x, y) ≡ m(0, x, y) mod 4
```
Известно, что все полные квадраты имеют либо вид `4k +1`, либо вид `4k`. 

Если `x` не кратен 4, то одно или оба из `e² + x` и `e² - x` не могут быть полными квадратами, что противоречит определению квадратного квадрата. Значит, `x` кратен 4. 

Аналогично, рассматривая `e² + y²` и `e² - y²`, получим, что `y` также кратен 4.

Значит, мы можем вынести коэффициент 4 за пределы квадрата и получить меньший квадратный квадрат, что противоречит минимальности исходного квадрата.

Следовательно, `e` нечётное.

2. Теперь воспользуемся тем, что `e` нечётное. В таком случае
```
e² ≡ 1 (mod 4)
3e² ≡ 3 (mod 4) - магическая константа
```

Теперь, если `x ≡ 1`, то `e² + x ≡ 2`, а если `x ≡ 3`, то `e² - x ≡ 2`. Если же `x ≡ 2`, то `e² + x ≡ 3`. Все эти случаи противоречат тому условию, что `e² - x` и `e² + x` должны быть полными квадратами. Следовательно, `x ≡ 0 (mod 4)`.

Тем же путём придём к `y ≡ 0 (mod 4)`, что и требовалось доказать.
</details>

</details>

#### Разноцветные квадраты
<details>
<summary>Разноцветные квадраты</summary>


</details>
</details>